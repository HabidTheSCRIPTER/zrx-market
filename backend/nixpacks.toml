# Nixpacks configuration for Railway - Backend Service
# This builds both frontend and backend

[phases.setup]
nixPkgs = ["nodejs_18", "npm-9_x"]

# Install frontend dependencies and build
[phases.install]
cmds = [
  "cd ../frontend && npm install",
  "cd ../frontend && npm run build",
  "cd ../backend && npm ci"
]

# Copy frontend build to backend dist folder
[phases.build]
cmds = [
  "mkdir -p dist",
  "cp -r ../frontend/dist/* ./dist/"
]

# Use npm start which runs "node server.js" from package.json
[start]
cmd = "npm start"
